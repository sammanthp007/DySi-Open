//
//  DySiPostTests.swift
//  DySiOpenTests
//
//  Created by Samman Thapa on 5/7/18.
//  Copyright Â© 2018 Samman Labs. All rights reserved.
//

import XCTest

@testable import DySi_Open

class DySiPostTests: XCTestCase {
    // GIVEN
    let validDictionary: [String:Any] = [
        "title": "ADPVoice: The Many Layers Of The Gender Pay Gap Issue",
        "description": "Equitable pay is at the foundation of any healthy employer-employee relationship. For business leaders who want to ensure fair treatment for all workers, as well as recruit and retain top talent, ensuring equitable pay practices are in place must be a top priority.",
        "cleanPermaLink": "https://www.forbes.com/sites/adp/2018/04/30/the-many-layers-of-the-gender-pay-gap-issue/?ss=business",
        "postType": "Text",
        "postBylineType": "Hidden",
        "author": [
            "author": "Dynamic Signal",
            "profileImageUrl": "https://yt3.ggpht.com/-fHEsbDJtMfw/AAAAAAAAAAI/AAAAAAAAAAA/LGqxowVJycs/s800-c-k-no-mo-rj-c0xffffff/photo.jpg",
            "providerUserId": "UCluZGsVZb1ZaJf1dYr6LWHQ",
            "providerUserName": "Dynamic Signal",
            "profileUrl": "http://www.youtube.com/channel/UCluZGsVZb1ZaJf1dYr6LWHQ",
            "postSourceName": "Dynamic Signal YouTube Channel",
            "postSourceSite": "youtube.com"
        ],
        "media": [
            [
                "url": "https://thumbor.forbes.com/thumbor/144x144/https%3A%2F%2Fblogs-images.forbes.com%2Fassets%2Fimages%2Favatars%2Fblog-4021_400_97a850929362009d96b9c142d2ad0544.jpg",
                "role": "image",
                ],
            [
                "url": "https://thumbor.forbes.com/thumbor/600x315/https%3A%2F%2Fblogs-images.forbes.com%2Fadp%2Ffiles%2F2018%2F04%2FADP-Pic-13.jpg",
                "role": "image,original",
                ]
        ],
        "createdDate": "2018-04-30T17:54:13.4188260Z"
    ]


    override func setUp() {
        super.setUp()
        // Put setup code here. This method is called before the invocation of each test method in the class.
    }

    override func tearDown() {
        // Put teardown code here. This method is called after the invocation of each test method in the class.
        super.tearDown()
    }

    func test_allPropertiesOfAuthorAreSetCorrectlyForAValidDictionary() {
        // WHEN
        let sut = DySiPost(postDict: validDictionary)!

        // THEN
        XCTAssertEqual(sut.author!.author, "Dynamic Signal")
        XCTAssertEqual(sut.author!.profileImageUrlString, "https://yt3.ggpht.com/-fHEsbDJtMfw/AAAAAAAAAAI/AAAAAAAAAAA/LGqxowVJycs/s800-c-k-no-mo-rj-c0xffffff/photo.jpg")
        XCTAssertEqual(sut.author!.providerUserId, "UCluZGsVZb1ZaJf1dYr6LWHQ")
        XCTAssertEqual(sut.author!.providerUserName, "Dynamic Signal")
        XCTAssertEqual(sut.author!.profileUrlString, "http://www.youtube.com/channel/UCluZGsVZb1ZaJf1dYr6LWHQ")
        XCTAssertEqual(sut.author!.postSourceName, "Dynamic Signal YouTube Channel")
        XCTAssertEqual(sut.author!.postSourceSiteString, "youtube.com")
    }

    func test_allPropertiesOfPostAreSetCorrectlyForAValidDictionary() {
        // WHEN
        let sut = DySiPost(postDict: validDictionary)!

        // THEN
        XCTAssertEqual(sut.title, "ADPVoice: The Many Layers Of The Gender Pay Gap Issue")
        XCTAssertEqual(sut.descriptionText, "Equitable pay is at the foundation of any healthy employer-employee relationship. For business leaders who want to ensure fair treatment for all workers, as well as recruit and retain top talent, ensuring equitable pay practices are in place must be a top priority.")
        XCTAssertEqual(sut.createdDateString, "2018-04-30T17:54:13.4188260Z")
        XCTAssertEqual(sut.dictOfImageUrls!["original"] as! String, "https://thumbor.forbes.com/thumbor/600x315/https%3A%2F%2Fblogs-images.forbes.com%2Fadp%2Ffiles%2F2018%2F04%2FADP-Pic-13.jpg")
        XCTAssertEqual(sut.dictOfImageUrls!["nonoriginals"] as! [String], ["https://thumbor.forbes.com/thumbor/144x144/https%3A%2F%2Fblogs-images.forbes.com%2Fassets%2Fimages%2Favatars%2Fblog-4021_400_97a850929362009d96b9c142d2ad0544.jpg"])
        XCTAssertEqual(sut.cleanPermaLinkString, "https://www.forbes.com/sites/adp/2018/04/30/the-many-layers-of-the-gender-pay-gap-issue/?ss=business")
    }

    func test_originalImageWhenUrlGivenHasSpacesInBetween() {
        // GIVEN
        var newDict = validDictionary
        newDict["media"] = [
            [
                "url": "https://thumbor.forbes.com/thumbor/144x144/abc def xyz.jpg",
                "role": "image",
                ],
            [
                "url": "https://thumbor.forbes.com/thumbor/600x315/pqrst3.jpg",
                "role": "image,original",
                ]
        ]

        // WHEN
        let sut = DySiPost(postDict: newDict)!

        // THEN
        XCTAssertEqual(sut.dictOfImageUrls!["original"] as! String, "https://thumbor.forbes.com/thumbor/600x315/pqrst3.jpg")
        XCTAssertEqual(sut.dictOfImageUrls!["nonoriginals"] as! [String], ["https://thumbor.forbes.com/thumbor/144x144/abc%20def%20xyz.jpg"])
    }
}
